need to change ip calculation in function 
ip is 0 for all the time 

